{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pending Dues Report | PEN</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {--brand-navy: #1A305E; --brand-red: #d50032; --bg-gray: #f8f9fc;}
body {background-color: var(--bg-gray); font-family: 'Segoe UI', sans-serif;}
.top-nav {background: var(--brand-navy); padding: 10px 0; border-bottom: 4px solid var(--brand-red); margin-bottom: 30px;}
.btn-back-link {color: white; text-decoration: none; font-weight: 600;}
.filter-card {background: white; border-radius: 12px; box-shadow:0 4px 12px rgba(0,0,0,0.05); padding:20px; margin-bottom:25px;}
.filter-label {font-size: 0.7rem; font-weight: 800; color: var(--brand-navy); text-transform: uppercase; margin-bottom: 5px; display:block;}
.form-select-custom, .form-control-custom {border: 2px solid #e2e8f0; border-radius:6px; font-size:0.9rem; padding:8px;}
.form-select-custom:focus, .form-control-custom:focus {border-color: var(--brand-red); box-shadow: none;}
.report-card {background:white; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.08); overflow:hidden;}
.table thead th {background-color: var(--brand-navy); color:white; font-size:0.75rem; text-transform:uppercase; padding:15px; border:none;}
.pending-amount {color: var(--brand-red); font-weight:800; font-size:1rem;}
.badge-active {background-color:#d1fae5; color:#065f46;}
.badge-inactive {background-color:#f3f4f6; color:#374151;}
.total-row {background-color:#fff5f5 !important; border-top:3px solid var(--brand-red) !important;}
.total-label {color: var(--brand-navy); font-weight:900; text-transform:uppercase;}
.btn-apply {background: var(--brand-red); color:white; border:none; font-weight:700; text-transform:uppercase; font-size:0.8rem; width:100%; min-height:40px;}
.btn-apply:hover {background:#b3002a; color:white;}
</style>
</head>
<body>

<nav class="top-nav">
    <div class="container d-flex justify-content-between align-items-center">
        <span class="text-white small fw-bold">Paradigm Educational Network</span>
    </div>
</nav>

<div class="container pb-5">
    <div class="row align-items-end mb-4">
        <div class="col">
            <a href="{{ dashboard_url }}" class="btn-back-link">
                <i class="fa-solid fa-arrow-left me-2"></i> DASHBOARD
            </a>
            <h2 class="fw-bold m-0" style="color:var(--brand-navy)">Pending Dues Recovery</h2>
            <p class="text-muted mb-0">Financial deficit tracking and defaulter management.</p>
        </div>
    </div>

    <!-- FILTER PANEL -->
    <div class="filter-card">
        <form method="get">
            <div class="row g-3 align-items-end">
                <div class="col-md-2">
                    <label class="filter-label">Class</label>
                    <select name="class" class="form-select form-select-custom">
                        <option value="">All Classes</option>
                        {% for cls in class_options %}
                        <option value="{{ cls.id }}" {% if cls.selected %}selected{% endif %}>{{ cls.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="filter-label">Month</label>
                    <select name="month" class="form-select form-select-custom">
                        <option value="">Full Year</option>
                        {% for m in month_options %}
                        <option value="{{ m.num }}" {% if m.selected %}selected{% endif %}>{{ m.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-1">
                    <label class="filter-label">Year</label>
                    <input type="number" name="year" class="form-control form-control-custom" value="{{ filters.year }}" placeholder="2026">
                </div>

                <div class="col-md-2 text-center">
                    <div class="form-check form-check-inline mt-4">
                        <input class="form-check-input" type="checkbox" name="include_inactive" {% if filters.include_inactive %}checked{% endif %}>
                        <label class="form-check-label small fw-bold text-muted">Include Inactive</label>
                    </div>
                </div>

                <div class="col-md-2">
                    <button type="submit" class="btn btn-apply">
                        <i class="fa-solid fa-filter me-2"></i> Update Report
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- SHOW SELECTED CLASS -->
    {% if selected_class_name %}
    <div class="mb-3">
        <span class="badge bg-primary px-3 py-2">
            <i class="fa-solid fa-layer-group me-1"></i>
            Class: {{ selected_class_name }}
        </span>
    </div>
    {% endif %}

    <!-- PENDING TABLE -->
    <div class="report-card">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Class</th>
                        <th>Pending Months</th>
                        <th>Year</th>
                        <th>Total Pending</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in pending_data %}
                    <tr>
                        <td>{{ item.student_name }}</td>
                        <td>{{ item.class_name }}</td>
                        <td>{{ item.pending_months }}</td>
                        <td>{{ item.year }}</td>
                        <td class="text-danger">{{ item.total_pending }}</td>
                        <td>
                            <span class="badge {% if item.status|lower == 'active' %}badge-active{% else %}badge-inactive{% endif %}">
                                {{ item.status }}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center py-5 text-muted">
                            <i class="fa-solid fa-check-circle fa-3x d-block mb-3 opacity-25"></i>
                            <h5>No Pending Dues Found</h5>
                            <p>All students have cleared accounts.</p>
                        </td>
                    </tr>
                    {% endfor %}

                    {% if pending_data %}
                    <tr class="total-row">
                        <td colspan="4" class="text-end"><span class="total-label">Grand Total Outstanding:</span></td>
                        <td class="text-center text-danger">{{ total_all_pending }}</td>
                        <td></td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <p class="text-center text-muted small mt-5">
        Â© 2026 Paradigm Educational Network | Confidential
    </p>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
