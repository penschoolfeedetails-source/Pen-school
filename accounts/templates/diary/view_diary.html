{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Diaries | PEN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --brand-navy: #1A305E;
            --brand-red: #d50032;
            --bg-gray: #f0f2f5;
        }

        body {
            background-color: var(--bg-gray);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Top Navigation */
        .top-nav {
            background: var(--brand-navy);
            padding: 12px 0;
            border-bottom: 4px solid var(--brand-red);
            margin-bottom: 30px;
        }

        /* Filter Section */
        .filter-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .form-label-custom {
            font-size: 0.75rem;
            font-weight: 800;
            color: var(--brand-navy);
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        /* Diary Page Styling */
        .diary-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            overflow: hidden;
            background: white;
            margin-bottom: 30px;
        }

        .diary-header {
            background: var(--brand-navy);
            color: white;
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .class-badge {
            background: var(--brand-red);
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .diary-date {
            font-weight: 600;
            opacity: 0.9;
        }

        /* Table Aesthetics */
        .table-diary thead th {
            background-color: #f8f9fa;
            color: #64748b;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #e2e8f0;
            padding: 12px 20px;
        }

        .subject-name {
            color: var(--brand-navy);
            font-weight: 700;
        }

        .teacher-name {
            font-size: 0.85rem;
            color: #64748b;
        }

        .diary-content {
            font-size: 0.95rem;
            color: #334155;
            line-height: 1.6;
            white-space: pre-line; /* Preserves line breaks in diary entry */
        }

        .btn-download {
            background: white;
            color: var(--brand-navy);
            font-weight: 700;
            font-size: 0.8rem;
            border: none;
            transition: 0.3s;
        }

        .btn-download:hover {
            background: var(--brand-red);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }
    </style>
</head>
<body>

<nav class="top-nav">
    <div class="container d-flex justify-content-between align-items-center">
        <a href="{{ dashboard_url }}" class="btn-back-link">
            <i class="fa-solid fa-arrow-left me-2"></i> DASHBOARD
        </a>
        <span class="text-white fw-bold"><i class="fa-solid fa-book-open me-2"></i> ACADEMIC DIARIES</span>
        <span class="text-white-50 small">Paradigm Educational Network</span>
    </div>
</nav>

<div class="container">
    
    <div class="filter-card">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label-custom">Select Class</label>
                <select name="class" class="form-select border-2">
                    <option value="">All Classes</option>
                    {% for cls in classes %}
                    <option value="{{ cls.id }}" {% if cls.is_selected %}selected{% endif %}>
                        {{ cls.name }} {{ cls.section }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label-custom">From Date</label>
                <input type="date" name="from_date" class="form-control border-2" value="{{ from_date }}">
            </div>
            <div class="col-md-3">
                <label class="form-label-custom">To Date</label>
                <input type="date" name="to_date" class="form-control border-2" value="{{ to_date }}">
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100 fw-bold py-2" style="background: var(--brand-navy); border:none;">
                    <i class="fa-solid fa-filter me-1"></i> Filter
                </button>
            </div>
        </form>
    </div>

    {% for page in diary_pages %}
    <div class="diary-card">
        <div class="diary-header">
            <div>
                <span class="class-badge me-2">{{ page.school_class }}</span>
                <span class="diary-date"><i class="fa-regular fa-calendar-check me-1"></i> {{ page.date }}</span>
            </div>
            <a class="btn btn-download btn-sm" href="{% url 'download_diary_pdf' page.school_class.id page.date %}">
                <i class="fa-solid fa-file-pdf me-1"></i> Download PDF
            </a>
        </div>
        <div class="table-responsive">
            <table class="table table-diary mb-0">
                <thead>
                    <tr>
                        <th style="width: 20%;">Subject</th>
                        <th style="width: 20%;">Teacher</th>
                        <th style="width: 60%;">Diary Task / Home Work</th>
                    </tr>
                </thead>
                <tbody>
                    {% for d in page.entries %}
                    <tr>
                        <td class="ps-4 py-3">
                            <div class="subject-name">{{ d.subject.name }}</div>
                        </td>
                        <td class="py-3">
                            <div class="teacher-name"><i class="fa-solid fa-user-tie me-1"></i> {{ d.teacher.first_name }}</div>
                        </td>
                        <td class="py-3 pe-4">
                            <div class="diary-content">{{ d.content }}</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% empty %}
    <div class="empty-state">
        <i class="fa-solid fa-box-archive fa-4x mb-3 opacity-25"></i>
        <h3>No Diaries Found</h3>
        <p>Try adjusting your date range or class filters.</p>
    </div>
    {% endfor %}

    <p class="text-center text-muted small mt-5 mb-5">
        Â© 2026 Paradigm Educational Network | Digital Diary Management System
    </p>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>