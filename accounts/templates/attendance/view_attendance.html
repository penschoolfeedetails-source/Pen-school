{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Attendance Records | PEN</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --brand-navy: #1A305E;
    --brand-red: #d50032;
    --bg-gray: #f8f9fc;
    --status-P: #28a745;
    --status-A: #dc3545;
    --status-L: #fd7e14;
    --status-SL: #0dcaf0;
}
body { background-color: var(--bg-gray); font-family: 'Segoe UI', system-ui, sans-serif; }
.top-nav { background: var(--brand-navy); padding: 10px 0; border-bottom: 4px solid var(--brand-red); margin-bottom: 30px; }
.btn-back-link { color: white; text-decoration: none; font-weight: 600; font-size: 0.9rem; }
.content-card { background: white; border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 25px; overflow: hidden; }
.card-header-navy { background: var(--brand-navy); color: white; padding: 15px 20px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
.table thead th { background-color: #f1f4f9; color: var(--brand-navy); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6; white-space: nowrap; }
.status-indicator { width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; border-radius: 6px; font-weight: 800; font-size: 0.75rem; color: white; }
.status-P { background-color: var(--status-P); }
.status-A { background-color: var(--status-A); }
.status-L { background-color: var(--status-L); }
.status-SL { background-color: var(--status-SL); }
.attendance-grid-wrapper { overflow-x: auto; max-height: 600px; }
.sticky-col { position: sticky; left: 0; background-color: white !important; z-index: 2; border-right: 2px solid #dee2e6 !important; }
.sticky-col-header { position: sticky; left: 0; z-index: 3; background-color: #f1f4f9 !important; }
</style>
</head>
<body>
<nav class="top-nav">
<div class="container d-flex justify-content-between align-items-center">
    <a href="{{ dashboard_url }}" class="btn-back-link">
    <i class="fa-solid fa-arrow-left me-2"></i> DASHBOARD
</a>

    <span class="text-white small fw-bold">Paradigm Educational Network</span>
</div>
</nav>

<div class="container pb-5">
<div class="row align-items-center mb-4">
    <div class="col-md-6">
        <h3 class="fw-bold m-0" style="color:var(--brand-navy)">
            <i class="fa-solid fa-calendar-check text-danger me-2"></i> Attendance Archives
        </h3>
    </div>
    <div class="col-md-6 text-md-end mt-3 mt-md-0">
        <form method="get" class="row g-2 justify-content-md-end">
            <div class="col-auto">
                <select name="class" class="form-select form-select-sm border-2">
                    <option value="">All Classes</option>
                    {% for cls in classes %}
                    <option value="{{ cls.id }}" {{ cls.selected|yesno:"selected," }}>
                        {{ cls.name }} {{ cls.section }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-auto">
                <input type="date" name="from_date" value="{{ from_date }}" class="form-control form-control-sm border-2">
            </div>
            <div class="col-auto">
                <input type="date" name="to_date" value="{{ to_date }}" class="form-control form-control-sm border-2">
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-dark btn-sm px-3 fw-bold">FILTER</button>
            </div>
        </form>
    </div>
</div>

<!-- Daily Summary Table -->
<div class="content-card">
<div class="card-header-navy">
    <span><i class="fa-solid fa-chart-pie me-2"></i> Daily Aggregate Summary</span>
</div>
<div class="table-responsive">
<table class="table table-hover align-middle">
<thead>
<tr>
    <th class="ps-4">Date</th>
    <th>Class</th>
    <th class="text-center">Total</th>
    <th class="text-center text-success">Present</th>
    <th class="text-center text-danger">Absent</th>
    <th class="text-center text-warning">Late</th>
    <th class="text-center text-info">Short Leave</th>
</tr>
</thead>
<tbody>
{% if summary %}
{% for row in summary %}
<tr>
    <td class="ps-4 fw-bold text-navy">{{ row.date }}</td>
    <td>
        <span class="badge bg-secondary">{{ row.class_name }}</span>
        <div class="mt-1">
            <a href="?class={{ row.class_id }}&date={{ row.date|date:'Y-m-d' }}" class="btn btn-sm btn-primary">View Attendance</a>


        </div>
    </td>
    <td class="text-center fw-bold">{{ row.total }}</td>
    <td class="text-center">{{ row.present }}</td>
    <td class="text-center">{{ row.absent }}</td>
    <td class="text-center">{{ row.late }}</td>
    <td class="text-center">{{ row.short_leave }}</td>
</tr>
{% endfor %}
{% else %}
<tr>
    <td colspan="7" class="text-center py-5 text-muted">No records match your selection.</td>
</tr>
{% endif %}
</tbody>
</table>
</div>
</div>

<!-- Student Attendance Grid -->
{% if student_grid %}
<div class="content-card mt-4">
<div class="card-header-navy" style="background-color: var(--brand-red);">
    <span><i class="fa-solid fa-users-viewfinder me-2"></i> Student Attendance ({{ selected_date }})</span>
</div>
<div class="attendance-grid-wrapper">
<table class="table table-sm table-bordered align-middle">
<thead>
<tr>
    <th class="ps-3 sticky-col sticky-col-header">Roll No</th>
    <th class="sticky-col sticky-col-header" style="left: 60px;">Student Name</th>
    <th class="text-center">Status</th>
    <th class="text-center">Action</th>
</tr>
</thead>
<tbody>
{% for student in student_grid %}
<tr>
    <td class="ps-3 sticky-col fw-bold text-muted">{{ student.roll_no }}</td>
    <td class="sticky-col fw-bold text-navy" style="left: 60px;">{{ student.name }}</td>
    <td class="text-center">
        {% if student.status != '-' %}
        <span class="status-indicator status-{{ student.status }}">{{ student.status }}</span>
        {% else %}
        <span class="text-muted small">-</span>
        {% endif %}
    </td>
    <td class="text-center">
        {% if student.record_id %}
        <a href="{% url 'update_attendance' student.record_id %}" class="btn btn-sm btn-warning">Update</a>
        {% endif %}
    </td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
{% endif %}

<p class="text-center text-muted small mt-4">Â© 2026 Paradigm Educational Network | MIS</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
